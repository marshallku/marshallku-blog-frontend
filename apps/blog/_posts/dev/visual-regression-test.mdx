---
title: Visual regression test ë„ì…ê¸°
description: BackstopJSì™€ Storybookì„ í™œìš©í•œ ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°
date:
  posted: 2024-06-01T13:53:54.428Z
tags:
  - Visual Regression Test
  - Testing
  - CI
  - BackstopJS
coverImage: /images/2024/05/comparing-images.png
ogImage: /images/2024/05/comparing-images.png
---

## Table of Contents

## Visual regression test ë„ì…ê¸°

í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ ì§„í–‰í•˜ë‹¤ ë³´ë©´, Unit test ë“±ì„ ì§„í–‰í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì€ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.\
ê°€ëœ©ì´ë‚˜ ì™¸ë¶€ì— ì˜ì¡´í•˜ëŠ” ê²ƒë“¤ì´ ë§ì•„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ìš´ë°, CSS ëª‡ ì¤„ ìˆ˜ì •í•˜ë‹¤ ë ˆì´ì•„ì›ƒì´ ì™•ì°½ ê¹¨ì§€ëŠ” ê²½ìš°ê°€ ìƒê¸°ë©´, ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì´ë§Œì €ë§Œì´ ì•„ë‹™ë‹ˆë‹¤.

ì´ëŸ° ê²½ìš°ê°€ ë¹„ë‹¨ ì €ë¿ë§Œì´ ì•„ë‹ˆë¼, ì—¬ëŸ¬ ê°œë°œìë“¤ì´ ê²ªëŠ” ë¬¸ì œê°™ì•„ ë„ì…í• ë§Œí•œ ë°©ë²•ë¡ ì´ ì—†ë‚˜ ì°¾ì•„ë³´ë˜ ì¤‘, [ì¹´ì¹´ì˜¤ ì—”í„°í…Œì¸ë¨¼íŠ¸ ê¸°ìˆ ë¸”ë¡œê·¸ ê¸€](https://fe-developers.kakaoent.com/2023/230223-backstopjs-vrt/)ì„ ë³´ê³  ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ë¥¼ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![BackstopJS ì˜ˆì œ í™”ë©´](/images/2024/06/backstopjs.png)

ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ëŠ” ë¸Œë¼ìš°ì € í™”ë©´ì„ ë¯¸ë¦¬ ìº¡ì²˜í•˜ì—¬ ì €ì¥í•´ë‘ê³ , ì´ì „ì— ìº¡ì²˜í•œ í™”ë©´ê³¼ ë¹„êµí•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ ì°¾ì•„ë‚´ëŠ” í…ŒìŠ¤íŠ¸ ë°©ë²•ì…ë‹ˆë‹¤.

ì´ë¯¸ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ì— Storybookì„ í™œìš©í•˜ê³  ìˆê¸°ì— Chromaticì„ ì‚¬ìš©í•˜ë©´ ê½¤ ì‰½ê²Œ ë„ì…í•  ìˆ˜ ìˆì—ˆì„ë“¯ í•˜ì§€ë§Œ, ìë£Œë¥¼ ì™¸ë¶€ì— ê³µê°œí•˜ê¸°ë„, ëˆì„ í‘í‘ ì“°ê¸°ë„ ê·¸ë ‡ë‹¤ ë³´ë‹ˆ ì§ì ‘ êµ¬ì¶•í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

- Turborepo
- Storybook
- BackstopJS
- GitHub Actions

ë“¤ì–´ê°€ê¸° ì „, ìœ„ì™€ ê°™ì€ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\
ì œ ë¸”ë¡œê·¸ë„ ê°™ì€ ê¸°ìˆ  ìŠ¤íƒì„ ì‚¬ìš© ì¤‘ì´ë¼, [Repository](https://github.com/marshallku/marshallku-blog-frontend)ë¥¼ ì°¸ê³ í•´ ë³´ì‹œë©´ ë„ì›€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## í´ë” êµ¬ì¡°

```txt
ğŸ“ marshallku-blog-frontend
â”œâ”€ ğŸ“‚ apps
â”‚  â”œâ”€ ğŸ“‚ blog
â”‚  â”œâ”€ ğŸ“‚ docs
â”‚  â””â”€ ğŸ“‚ visual-regression
â””â”€ ğŸ“ packages
```

`docs`ì—ëŠ” Storybookì„, `visual-regression`ì—ëŠ” BackstopJSë¥¼ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

êµ³ì´ ë³„ë„ì˜ ì•±ìœ¼ë¡œ ë¶„ë¦¬í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ, ë‘˜ì˜ ì„±ì§ˆì´ ë§ì´ ë‹¬ë¼ íŒŒì¼ë“¤ì„ ë³„ë„ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì€ ë§ˆìŒì— ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

## Storybook

ì„¤ì •ì´ë‚˜ ì‚¬ìš©ë²• ë“±ì€ [`docs`](https://github.com/marshallku/marshallku-blog-frontend/tree/master/apps/docs) í´ë”ë¥¼ ì°¸ê³ í•´ ì£¼ì„¸ìš”.

### Document ì‘ì„±

```tsx
// apps/docs/stories/Typography.stories.tsx
import type { Meta, StoryObj } from "@storybook/react";
import Typography, { type TypographyProps } from "@ui/Typography";

const story: Meta<TypographyProps> = {
    component: Typography,
    title: "Typography/Typography",
    tags: ["autodocs"],
    parameters: {
        docs: {
            description: {
                component: "Displays text in a visually appealing way",
            },
        },
    },
};

export default story;

export const Default: StoryObj<TypographyProps> = {
    args: {
        children: "Hello World!",
    },
};
```

Storybookì—ì„œ í‰ì†Œë‘ ë‹¤ë¥¼ ê²ƒì€ ì—†ìŠµë‹ˆë‹¤.\
í•˜ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ CSSë¥¼ ë³€ê²½í•˜ëŠ” ë“±ì˜ ìƒí™©ì— ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë¯¸ë¦¬ ê°ì§€í•˜ê³ ìí•˜ëŠ” ëª©ì ì´ê¸°ì—, ê°€ëŠ¥í•œ ë§ì€ ìƒí™©ì— ëŒ€í•œ Storyë¥¼ ë¯¸ë¦¬ ì‘ì„±í•´ ë‘ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

## BackstopJS

### ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ ì„¤ì •

```json
// apps/visual-regression/package.json
{
    // ...
    "devDependencies": {
        "@types/backstopjs": "^6.1.3",
        "backstopjs": "^6.3.23",
    }
}
```

ë¨¼ì €, `apps/visual-regression` í´ë”ì— ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•´ì•¼ í•©ë‹ˆë‹¤.

`backstopjs`, `@types/backstopjs` ë‘ íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼í•  íŒ¨í‚¤ì§€ëŠ” ëì…ë‹ˆë‹¤.

```js
/** @type {import('backstopjs').Config} */
const config = {
    id: "backstop_default",
    viewports: [
        {
            label: "phone",
            width: 320,
            height: 480,
        },
        {
            label: "tablet",
            width: 1024,
            height: 768,
        },
    ],
    onBeforeScript: "puppet/onBefore.js",
    onReadyScript: "puppet/onReady.js",
    scenarios: [],
    paths: {
        bitmaps_reference: "backstop_data/bitmaps_reference",
        bitmaps_test: "backstop_data/bitmaps_test",
        engine_scripts: "backstop_data/engine_scripts",
        html_report: "backstop_data/html_report",
        ci_report: "backstop_data/ci_report",
    },
    report: ["browser"],
    engine: "puppeteer",
    engineOptions: {
        args: ["--no-sandbox"],
    },
    asyncCaptureLimit: 5,
    asyncCompareLimit: 50,
    debug: false,
    debugWindow: false,
};

module.exports = config;
```

`npx backstop init` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìœ„ì™€ ê°™ì´ ì„¤ì • íŒŒì¼ê³¼ í•¨ê»˜ `backstop_data` í´ë”ì— BackstopJSê°€ ì‚¬ìš©í•  íŒŒì¼ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤.

```txt
**/backstop_data/html_report
**/backstop_data/bitmaps_test
**/test-results
```

ìœ„ì™€ ê°™ì´ ë¶ˆí•„ìš”í•œ í´ë”ë“¤ì„ `.gitignore`ì— ì¶”ê°€í•´ ì£¼ê³ 

```json
// apps/visual-regression/backstop_data/engine_scripts/cookies.json
[
    {
        "domain": ".marshallku.com",
        "path": "/",
        "name": "key",
        "value": "value",
        "expirationDate": 1798790400,
        "hostOnly": false,
        "httpOnly": false,
        "secure": false,
        "session": false,
        "sameSite": "Lax"
    }
]
```

í˜¹ì‹œ í•„ìš”í•˜ë‹¤ë©´, `cookies.json`ì— ì¿ í‚¤ë¥¼ ì¶”ê°€í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
// apps/visual-regression/package.json
{
    // ...
    "scripts": {
        "test:visual-regression": "backstop test --config=\"backstop.config.js\"",
        "backstop:reference": "backstop reference --config=\"backstop.config.js\"",
        "backstop:approve": "backstop approve --config=\"backstop.config.js\"",
        "backstop:openReport": "backstop openReport --config=\"backstop.config.js\"",
        "clean": "rm -rf .turbo && rm -rf node_modules"
    },
}
```

ë‹¤ìŒìœ¼ë¡œ, `package.json`ì— ìœ„ì™€ ê°™ì´ BackstopJSì—ì„œ ì‚¬ìš©í•  ëª…ë ¹ì–´ë“¤ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```json
// ...
"scripts": {
    // ...
    "test:visual-regression": "turbo run test:visual-regression",
}
// ...
```

ë§ˆì§€ë§‰ìœ¼ë¡œ, í”„ë¡œì íŠ¸ì˜ rootì— ìˆëŠ” `package.json`ì— `test:visual-regression` ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•´ ì£¼ì‹œë©´, `turbo`ë¥¼ í†µí•´ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Express ì„œë²„ êµ¬ì„±

Storybookì— ì‘ì„±í•œ ë¬¸ì„œë¥¼ í™•ì¸í•´ì•¼ í•˜ê¸°ì—, Express ì„œë²„ë¥¼ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

```js
// apps/visual-regression/server.js
const http = require("http");
const express = require("express");
const path = require("path");

const app = express();
const port = 8083;

const filePath = path.resolve("..", "docs", "storybook-static");

app.use(express.static(filePath));

app.use("*", (_, res) => {
    res.sendFile(path.join(filePath, "index.html"));
});

const server = http.createServer(app);

server.listen(port, () => {
    console.log(`Server is running on http://localhost:${port}`);
});
```

í•„ìš”í•œ ê¸°ëŠ¥ì´ë¼ê³¤ Storybook ë¹Œë“œ ê²°ê³¼ë¬¼ì„ ê·¸ëŒ€ë¡œ ì„œë¹™í•´ì£¼ëŠ” ê²ƒ ë¿ì´ê¸°ì—, ìœ„ì™€ ê°™ì´ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
// turbo.json
"test:visual-regression": {
    "cache": false,
    "dependsOn": ["^build"]
},
```

Storybookì˜ ë¹Œë“œ ê²°ê³¼ë¬¼ì´ ë°˜ë“œì‹œ í•„ìš”í•˜ê¸°ì—, `turbo.json`ì— ìœ„ì™€ ê°™ì´ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ ì£¼ì‹œë©´ ì‹¤ìˆ˜í•  ì—¬ì§€ë¥¼ ë§ì´ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
// apps/visual-regression/package.json
"scripts": {
    "dev": "node server.js",
    // ...
},
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ì„œë²„ë¥¼ ê¸°ë™í•  ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

### Storybook ë¹Œë“œ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ì‹œë‚˜ë¦¬ì˜¤ë“¤ì„ `backstop.config.js`ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

![Storybook ë¹Œë“œ ê²°ê³¼ json íŒŒì¼](/images/2024/06/storybook-json.png)

Storybook ë¹Œë“œ ê²°ê³¼ë¬¼ì—ëŠ” `index.json` íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.\
í•´ë‹¹ íŒŒì¼ì—ëŠ” Storybookì— ì‘ì„±í•œ ë¬¸ì„œë“¤ì— ëŒ€í•œ ì •ë³´ê°€ ìˆê¸°ì—, ì´ë¥¼ ì´ìš©í•´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
// apps/visual-regression/backstop.config.js
const storyData = require("../docs/storybook-static/index.json");

const stories = Object.values(storyData.entries);
const blackList = [];

/** @type {import('backstopjs').Config} */
const config = {
    // ...
    scenarios: stories
        .filter((story) => story.type !== "docs" && !blackList.includes(story.id))
        .map((story) => ({
            label: story.id,
            cookiePath: "",
            url: `http://localhost:8083/iframe.html?id=${story.id}&viewMode=story`,
            referenceUrl: "",
            readyEvent: "",
            readySelector: "#storybook-root",
            delay: 3000,
            hideSelectors: [],
            removeSelectors: [],
            hoverSelector: "",
            clickSelector: "",
            postInteractionWait: 0,
            selectors: [],
            selectorExpansion: true,
            expect: 0,
            misMatchThreshold: 0.1,
            requireSameDimensions: true,
        })),
    // ...
};
```

ìœ„ì™€ ê°™ì´ `index.json` íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¶”ê°€í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\
ë¬¸ì„œ íŒŒì¼ì€ ë‘ ë²ˆ ê²€ì‚¬í•  í•„ìš”ê°€ ì—†ìœ¼ë‹ˆ ì œê±°í•˜ê³ , í˜¹ì‹œ í…ŒìŠ¤íŠ¸ê°€ í•„ìš” ì—†ëŠ” ê²½ìš°ì—ëŠ” `blackList`ì— ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

Storybook ë‚´ë¶€ì— ì‚¬ìš©ë˜ëŠ” `iframe.html` íŒŒì¼ì„ ì‚¬ìš©í•˜ë©´ ë³„ë‹¤ë¥¸ ë…¸ë ¥ì„ ë“¤ì´ì§€ ì•Šì•„ë„ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

ì—¬ê¸°ê¹Œì§€ ì™„ë£Œë˜ì—ˆìœ¼ë©´, í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´, `backstop:reference` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ ê¸°ì¤€ì´ ë  íŒŒì¼ë“¤ì„ ìƒì„±í•˜ê³ , `test:visual-regression`ì„ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

## GitHub Actions íŒŒì´í”„ë¼ì¸ êµ¬ì„±

ë§¤ë²ˆ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆœ ì—†ìœ¼ë‹ˆ, GitHub Actionsë¥¼ í†µí•´ ìë™í™”í•˜ì˜€ìŠµë‹ˆë‹¤.

ë”ë¶ˆì–´ ì»¨í…Œì´ë„ˆ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ê¸°ì—, ë³„ë„ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ì¼ê´€ëœ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë³€ê²½ ì‚¬í•­ í…ŒìŠ¤íŠ¸

```yaml
# .github/workflows/check_pr.yml
name: Check PR

on:
    pull_request:

env:
    CI: true

jobs:
    visual-regression-test:
        name: Run visual regression test
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: marshallku/actions/setup-pnpm@master
            # Puppeteer ì„¤ì¹˜
            - name: Install puppeteer
              run: npx puppeteer browsers install chrome
            # Express ì„œë²„ ì‹¤í–‰
            # Backgroundì—ì„œ ì‹¤í–‰í•´ì•¼ í•˜ê¸°ì— &ë¥¼ ì¶”ê°€
            - name: Run backstop server in background
              run: pnpm dev --filter @marshallku/visual-regression &
            # Storybook ë¹Œë“œ
            # `turbo.json`ì— ì˜ì¡´ì„±ì„ ì¶”ê°€í–ˆê¸°ì—, êµ³ì´ ì¶”ê°€í•˜ì§€ëŠ” ì•Šì•„ë„ ë¨
            - name: Build apps and packages without blog
              run: pnpm build --filter !@marshallku/blog
            # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            - name: Run test
              id: test
              # ì˜ë„ëœ ë³€í™”ì¸ ê²½ìš°ë„ ë§ê¸°ì—, ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
              continue-on-error: true
              run: pnpm test:visual-regression
            # í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ PR ëŒ“ê¸€ë¡œ ì¶”ê°€
            - name: Check test result
              if: ${{ !cancelled() }}
              uses: thollander/actions-comment-pull-request@v2
              with:
                  message: |
                      Test result - ${{ steps.test.outcome }}

                      You can check results [here](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
            # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
            - name: Upload test results
              uses: actions/upload-artifact@v4
              if: ${{ !cancelled() }}
              with:
                  name: backstop-data
                  path: apps/visual-regression/backstop_data
                  retention-days: 30
```

Pull Requestë¥¼ ìƒì„±í–ˆì„ ë•Œ, ë³€ê²½ ì‚¬í•­ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ì— ìƒì„±ë˜ì–´ìˆë˜ Reference ìŠ¤í¬ë¦° ìƒ·ê³¼, ë³€ê²½ëœ ìŠ¤í¬ë¦° ìƒ·ì„ ë¹„êµí•´ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³ , PRì— ëŒ“ê¸€ë¡œ ê²°ê³¼ë¥¼ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.

ì œ ê°œì¸ ë¸”ë¡œê·¸ì— ê°„ë‹¨í•˜ê²Œ ì ìš©í•œ íŒŒì´í”„ë¼ì¸ì´ë¼, í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë‹¨ìˆœíˆ GitHub Artifactì— ì—…ë¡œë“œí•˜ëŠ” ë°©í–¥ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.\
ì—¬ëŸ¬ ì‚¬ëŒì´ ì‘ì—…í•˜ëŠ” ê²½ìš°ì—ëŠ”, S3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì£¼ì†Œë¥¼ ëŒ“ê¸€ë¡œ ì¶”ê°€í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ êµ¬ì„±í•´ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Reference íŒŒì¼ ì—…ë°ì´íŠ¸

PRì´ ìŠ¹ì¸ë˜ê³ , `master` ë¸Œëœì¹˜ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ì´ì œ Reference íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
#!/bin/bash

if [[ -z $(git status --porcelain) ]]; then
    exit 0
fi

files_to_commit=${FILES:-"-A"}

git config user.name github-actions[bot]
git config user.email 41898282+github-actions[bot]@users.noreply.github.com
git add "$files_to_commit"
git commit -m "$MESSAGE"
git push
```

ë¨¼ì €, Reference íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ì´ë¥¼ ì»¤ë°‹í•˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```yaml
# .github/workflows/visual_regression.yml
name: Visual Regression Test

on:
    push:
        branches:
            - master
    workflow_dispatch:

concurrency: ${{ github.workflow }}-${{ github.ref }}

jobs:
    test:
        name: Run visual regression test
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: marshallku/actions/setup-pnpm@master
            - name: Install puppeteer
              run: npx puppeteer browsers install chrome
            - name: Run backstop server in background
              run: pnpm dev --filter @marshallku/visual-regression &
            - name: Build apps and packages without blog
              run: pnpm build --filter !@marshallku/blog
            - name: Run test
              id: test
              continue-on-error: true
              run: pnpm test:visual-regression
            - name: Create commit comment
              if: ${{ !cancelled() }}
              uses: peter-evans/commit-comment@v3
              with:
                  body: |
                      Visual regression test result - **${{ steps.test.outcome }}**
            # PR í™•ì¸í•  ë•Œì™€ ë‹¬ë¦¬, reference íŒŒì¼ì„ ì—…ë°ì´íŠ¸
            - name: Approve results
              if: ${{ steps.test.outcome == 'failure' }}
              run: |
                  cd apps/visual-regression
                  pnpm backstop:approve
            - name: Commit changes
              if: ${{ steps.test.outcome == 'failure' }}
              run: bash .github/scripts/commit.sh
              env:
                  MESSAGE: "Update visual regression test results"
```

ë‹¤ìŒìœ¼ë¡œ, PRì„ í™•ì¸í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\
ë‹¤ë§Œ, PRì„ í™•ì¸í•  ë•Œì™€ ë‹¬ë¦¬, í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œ ë’¤ ê·¸ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ Reference íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ì´ë¥¼ ì»¤ë°‹í•˜ëŠ” ì‘ì—…ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

## ë§ˆì¹˜ë©°

í•­ìƒ í”„ë¡ íŠ¸ì—”ë“œì—ì„œì˜ í…ŒìŠ¤íŒ…ì— ëŒ€í•´ ê³ ë¯¼ì´ ë§ì•˜ìŠµë‹ˆë‹¤.\
ë°±ì—”ë“œì—ì„œ ì½”ë“œë¥¼ ì‘ì„±í•  ë• ë‚˜ë¦„ ì…ì¶œë ¥ì´ ì •í™•í•˜ê³ , í™˜ê²½ì„ ì œê°€ ì œì–´í•  ìˆ˜ ìˆìœ¼ë‹ˆ ëª…í™•í•˜ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì—ˆì§€ë§Œ, í”„ë¡ íŠ¸ì—”ë“œëŠ” ê±°ëŒ€í•˜ê²Œ ìƒíƒœê°€ ê´€ë¦¬ë˜ê³ , ë¸Œë¼ìš°ì €ë¼ëŠ” ì™¸ë¶€ í™˜ê²½ì—ì„œ ë™ì‘í•˜ê¸°ì— í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ìš´ ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.\
ë”êµ°ë‹¤ë‚˜, ë¡œì§ ìˆ˜ì • ì¤‘ì— ë°œìƒí•˜ëŠ” ë ˆì´ì•„ì›ƒ ê´€ë ¨ Side EffectëŠ” ëˆˆìœ¼ë¡œ í™•ì¸í•´ì•¼ë§Œ í•˜ëŠ” ê²½ìš°ê°€ ê½¤ ë§ì•˜ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ë¥¼ ë„ì…í•˜ë©° UIì— ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ì‚¬ì „ì— ê°ì§€í•˜ê³ , íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\
ë˜í•œ, CI íŒŒì´í”„ë¼ì¸ì— ì´ ê³¼ì •ì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆê¸°ì—, ê°œë°œ í”„ë¡œì„¸ìŠ¤ ì „ë°˜ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” UI ê´€ë ¨ ë²„ê·¸ë¥¼ ì¤„ì¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì…ì¶œë ¥ì´ ì •í™•í•œ í•¨ìˆ˜ë“¤ì— ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•´ ë‘ê³ , í•µì‹¬ ë¡œì§ì— Playwright ë“±ì„ ì‚¬ìš©í•´ E2E í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•œ ë’¤, ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ê¹Œì§€ ì¶”ê°€í•´ ë‘ë‹ˆ ì½”ë“œ ë³€ê²½ì— ëŒ€í•œ ë¶€ë‹´ì´ ì—¬ëŸ¬ ë°©ë©´ì—ì„œ ë§ì´ ì¤„ì–´ë“  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

![ë¸”ë¡œê·¸ CI íŒŒì´í”„ë¼ì¸](/images/2024/06/blog-ci-pipelines.png)

ì—¬ë‹´ìœ¼ë¡œ, ì´ë ‡ê²Œê¹Œì§€ ë³µì¡í•  í•„ìš”ê°€ ì—†ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì¸ë° ë¸”ë¡œê·¸ì— push í•œ ë²ˆ í•˜ë©´ ëŒì•„ê°€ëŠ” CI íŒŒì´í”„ë¼ì¸ì´ ì´ë ‡ê²Œë‚˜ ë§ì•„ì ¸ ë²„ë ¸ìŠµë‹ˆë‹¤.
